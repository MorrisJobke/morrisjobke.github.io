<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Morris Jobke</title><link rel=stylesheet href=/css/pygment_trac.css?1674821570><link rel=alternate type=application/atom+xml title="Atom feed" href=/feed.xml><link rel=stylesheet href=/css/webfonts.css?1674821570><link rel=stylesheet href=/css/base.css?1674821570><meta property="og:title" content="Dokku - An easy way to deploy web apps"><meta property="og:description" content="TL;DR Use easy-to-setup Dokku and push your code via git to have it deployed in a docker container without hassle. Bonus points for subdomain and Let&rsquo;s Encrypt support.
I was looking for a nice way to deploy some small apps quickly without juggling all the time webserver configs and think about the ports or domains under which I should host them.
Additionally I want to play with docker to deploy apps."><meta property="og:type" content="article"><meta property="og:url" content="https://morrisjobke.de/2016/02/21/Dokku-Easy-way-to-deploy-web-apps/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-02-21T16:55:00+00:00"><meta property="article:modified_time" content="2016-02-21T16:55:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dokku - An easy way to deploy web apps"><meta name=twitter:description content="TL;DR Use easy-to-setup Dokku and push your code via git to have it deployed in a docker container without hassle. Bonus points for subdomain and Let&rsquo;s Encrypt support.
I was looking for a nice way to deploy some small apps quickly without juggling all the time webserver configs and think about the ports or domains under which I should host them.
Additionally I want to play with docker to deploy apps."><meta name=twitter:site content="@MorrisJobke"><meta itemprop=name content="Dokku - An easy way to deploy web apps"><meta itemprop=description content="TL;DR Use easy-to-setup Dokku and push your code via git to have it deployed in a docker container without hassle. Bonus points for subdomain and Let&rsquo;s Encrypt support.
I was looking for a nice way to deploy some small apps quickly without juggling all the time webserver configs and think about the ports or domains under which I should host them.
Additionally I want to play with docker to deploy apps."><meta itemprop=datePublished content="2016-02-21T16:55:00+00:00"><meta itemprop=dateModified content="2016-02-21T16:55:00+00:00"><meta itemprop=wordCount content="1004"><meta itemprop=keywords content></head><body><div class=header><div class=container><span class=name>Morris<b>Jobke</b></span><ul class=menu><li><a href=/>Articles</a></li>/<li><a href=/emobility>E-mobility</a></li>/<li><a href=/talks>Talks</a></li>/<li><a href=/links>Links</a></li><li class=item-right><a href=/feed.xml><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M576 1344q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm512 123q2 28-17 48-18 21-47 21H889q-25 0-43-16.5t-20-41.5q-22-229-184.5-391.5T250 902q-25-2-41.5-20T192 839V704q0-29 21-47 17-17 43-17h5q160 13 306 80.5T826 902q114 113 181.5 259t80.5 306zm512 2q2 27-18 47-18 20-46 20h-143q-26 0-44.5-17.5T1329 1476q-12-215-101-408.5t-231.5-336-336-231.5T252 398q-25-1-42.5-19.5T192 335V192q0-28 20-46 18-18 44-18h3q262 13 501.5 120T1186 542q187 186 294 425.5t120 501.5z" fill="#fff"/></svg></a></li><li class=item-right><a href=https://twitter.com/MorrisJobke><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z" fill="#fff"/></svg></a></li><li class=item-right><a href=https://github.com/MorrisJobke><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1664 896q0 251-146.5 451.5T1139 1625q-27 5-39.5-7t-12.5-30v-211q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 89t.5 54q0 18-13 30t-40 7q-232-77-378.5-277.5T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z" fill="#fff"/></svg></a></li></ul></div></div><div class=container><h1>Dokku - An easy way to deploy web apps <span class=meta>21 Feb 2016</span></h1><div id=post><blockquote><p>TL;DR Use easy-to-setup <a href=http://dokku.viewdocs.io/dokku/>Dokku</a> and push your code via git to have it deployed in a docker container without hassle. Bonus points for subdomain and Let&rsquo;s Encrypt support.</p></blockquote><p>I was looking for a nice way to deploy some small apps quickly without juggling all the time webserver configs and think about the ports or domains under which I should host them.</p><p>Additionally I want to play with <a href=https://docker.io>docker</a> to deploy apps. I searched a bit and have found <a href=http://kubernetes.io>Kubernetes</a> - a scalable solution to run any docker container in a clustered high availablilty environment. This sounded a bit overkill for my scenario - but I gave it a try. I have choosen the <a href=http://kubernetes.io/v1.1/docs/getting-started-guides/docker.html>docker based installation method</a>. It was easy, quite fast and started a ton of services. In the end it revealed that it was a total overkill and needed more configuration than the old way based on web server config juggling. I abandoned this tool quickly because I realized that it was build for really large setups.</p><h1 id=dokku>Dokku</h1><p>Then I found <a href=http://dokku.viewdocs.io/dokku/>Dokku</a> which advertises it self as &ldquo;The smallest PaaS implementation you&rsquo;ve ever seen - Docker powered mini-Heroku in around 200 lines of Bash&rdquo;.</p><p>What does Dokku do? Basically it sets up a Nginx webserver, a user called dokku and brings a command line tool. Now you are able to use a git repository that is based on either a <a href=http://dokku.viewdocs.io/dokku/deployment/buildpacks/>Heroku image</a> or contains a <a href=http://dokku.viewdocs.io/dokku/deployment/dockerfiles/>Dockerfile</a> as base for the deployment. Just add the dokku host as a git remote (with the git repo name as the name it should be managed on the dokku server) and push to that repository:</p><pre><code>$ git remote add dokku dokku@example.org:php
$ git push dokku master
Counting objects: 145, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (80/80), done.
Writing objects: 100% (145/145), 28.77 KiB | 0 bytes/s, done.
Total 145 (delta 54), reused 139 (delta 51)
-----&gt; Cleaning up...
-----&gt; Building php from herokuish...
...
... output truncated for brevity
...
=====&gt; Application deployed:
       http://example.org:32770 (container)
       http://example.org:80 (nginx)

To dokku@example.org:php
 * [new branch]      master -&gt; master
</code></pre><p>That&rsquo;s all - now the app could be accessed by browsing <code>http://example.org:32770</code>. Dokku also supports subdomain based apps and SSL, but I will talk about this later.</p><p>For the above example I used Herokus <a href=https://github.com/heroku/php-getting-started>Getting started with PHP</a>.</p><h2 id=dokku-on-archlinux>Dokku on ArchLinux</h2><p>The only drawback of this tool was that only Ubuntu 14.04 was supported, but I thought it couldn&rsquo;t be too hard to somehow make those 200 lines of Bash compatible with ArchLinux (which I currently use on my server). It turned out that 200 lines of Bash is the optimistic view on the code base, but who cares - I fixed the issues I had, <a href=https://github.com/dokku/dokku/pull/1918>opened a pull request</a>, <a href=https://aur.archlinux.org/packages/dokku/>updated the AUR package</a> and had some nice chats with the maintainers. Now the setup on ArchLinux is a breeze:</p><pre><code>$ pacaur -S dokku
$ cat ~/.ssh/id_rsa.pub | sudo sshcommand acl-add dokku 'local key'
</code></pre><p>The above three commands install the <code>dokku</code> package and add the local SSH key as allowed authentication token. With this command other SSH keys could also be added to gain management access to the dokku server.</p><h2 id=subdomains-aka-vhosts>Subdomains a.k.a. vhosts</h2><p>By default dokku deploys all the different apps on different ports, but it also supports domains and subdomains. To use this feature just add a wildcard DNS to point to the dokku server and specify that domain in dokku as vhost base domain.</p><pre><code>$ cat /var/lib/dokku/VHOST
example.org
</code></pre><p>Then dokku will catch up this setting and deploy all apps as <code>APPNAME.example.org</code> instead of <code>example.org:32770</code>.</p><p>The above deploy step then looks like this:</p><pre><code>$ git remote add dokku dokku@example.org:php
$ git push dokku master
-----&gt; Cleaning up...
-----&gt; Building php from herokuish...
...
... output truncated for brevity
...
=====&gt; Application deployed:
       http://php.example.org
</code></pre><p>The app now could be accessed by browsing <code>http://php.example.org</code>.</p><h2 id=https-via-lets-encrypt>HTTPS via Let&rsquo;s Encrypt</h2><p>End of last year Let&rsquo;s Encrypt entered <a href=https://letsencrypt.org/2015/12/03/entering-public-beta.html>public beta</a>. As it was build to allow automatic SSL certificate creation it is the ideal way to bring HTTPS to those dokku apps.</p><p>Dokku allows to be extended by so called plugins and as you already imagine there is a plugin to bring Let&rsquo;s Encrypt and Dokku together. It was build by <a href=https://blog.semicolonsoftware.de/securing-dokku-with-lets-encrypt-tls-certificates/>Stefan Seemayer</a> and could be installed with following command:</p><pre><code>$ sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git
</code></pre><p>Then only two commands are left to have a fully working HTTPS setup for the <code>php</code> app:</p><pre><code>$ ssh dokku@example.org letsencrypt:email php email@example.org
=====&gt; Setting Let's Encrypt e-mail address for php to 'email@example.org'
$ ssh dokku@example.org letsencrypt php
=====&gt; Let's Encrypt php...
-----&gt; Updating letsencrypt docker image...
latest: Pulling from m3adow/letsencrypt-simp_le
...
... output truncated for brevity
...
-----&gt; Certificate retrieved successfully.
-----&gt; Symlinking let's encrypt certificates
-----&gt; Configuring SSL for php.example.org...
-----&gt; Creating https nginx.conf
-----&gt; Running nginx-pre-reload
       Reloading nginx
-----&gt; Disabling ACME proxy for php...
       done
</code></pre><p>Now your app is secured by an Let&rsquo;s Encrypt certificate. Also the redirects from unencrypted to the encrypted version of your app are set up.</p><p>Tip: Checkout the help section of the command:</p><pre><code>$ ssh dokku@cloud.morrisjobke.de help            
Usage: dokku [--quiet|--trace|--rm-container|--rm|--force] COMMAND &lt;app&gt; [command-specific-options]

Options:
apps                               List your apps
apps:create &lt;app&gt;                  Create a new app
apps:destroy &lt;app&gt;                 Permanently destroy an app
apps:rename &lt;old-app&gt; &lt;new-app&gt;    Rename an app
backup:export [file]               Export dokku configuration files
backup:import [file]               Import dokku configuration files
...
</code></pre><h2 id=show-me-the-commands>Show me the commands!</h2><ul><li><p>add git remote</p><pre><code>  $ git remote add dokku dokku@example.org:APPNAME
</code></pre></li><li><p>deploy (update of) an app</p><pre><code>  $ git push dokku master
</code></pre></li><li><p>configure Let&rsquo;s Encrypt plugin</p><pre><code>  $ ssh dokku@example.org letsencrypt:email APPNAME email@example.org
</code></pre></li><li><p>switch to Let&rsquo;s Encrypt based HTTPS setup for an app</p><pre><code>  $ ssh dokku@example.org letsencrypt APPNAME
</code></pre></li></ul><h2 id=thanks>Thanks</h2><p>A huge thanks to all Dokku contributors for this really nice tool! A special thanks to <a href=https://github.com/michaelshobbs>Michael Hobbs</a> for answering me my first questions about it on IRC, <a href=http://josediazgonzalez.com>Jose Diaz-Gonzalez</a> for reviewing my pull request and <a href=https://blog.semicolonsoftware.de/securing-dokku-with-lets-encrypt-tls-certificates/>Stefan Seemayer</a> for the Let&rsquo;s Encrypt plugin. It was a very warm welcome in that community :) The open source community rocks all the time and I&rsquo;m hugely impressed again and again :)</p></div></div><div class="container footer">Morris Jobke - <a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a></div></body></html>