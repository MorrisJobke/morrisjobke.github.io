<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Morris Jobke</title><link rel=stylesheet href=/css/pygment_trac.css?1666873800><link rel=alternate type=application/atom+xml title="Atom feed" href=/feed.xml><link rel=stylesheet href=/css/webfonts.css?1666873800><link rel=stylesheet href=/css/base.css?1666873800><meta property="og:title" content="Conditional Logging in ownCloud"><meta property="og:description" content="If you have an installation of ownCloud and you experience a bug it is quite difficult to debug the problem, because usually only errors and warnings are logged. But to identify a problem it is really helpful to log more stuff to get all the information that are needed. Wouldn&rsquo;t it be cool to raise the log level from &ldquo;warning&rdquo; to &ldquo;debug&rdquo; just for specific conditions? That&rsquo;s what I just added some time ago and it landed in ownCloud 8."><meta property="og:type" content="article"><meta property="og:url" content="https://morrisjobke.de/2015/07/22/Conditional-Logging-in-ownCloud/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-07-22T19:46:00+00:00"><meta property="article:modified_time" content="2015-07-22T19:46:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Conditional Logging in ownCloud"><meta name=twitter:description content="If you have an installation of ownCloud and you experience a bug it is quite difficult to debug the problem, because usually only errors and warnings are logged. But to identify a problem it is really helpful to log more stuff to get all the information that are needed. Wouldn&rsquo;t it be cool to raise the log level from &ldquo;warning&rdquo; to &ldquo;debug&rdquo; just for specific conditions? That&rsquo;s what I just added some time ago and it landed in ownCloud 8."><meta name=twitter:site content="@MorrisJobke"><meta itemprop=name content="Conditional Logging in ownCloud"><meta itemprop=description content="If you have an installation of ownCloud and you experience a bug it is quite difficult to debug the problem, because usually only errors and warnings are logged. But to identify a problem it is really helpful to log more stuff to get all the information that are needed. Wouldn&rsquo;t it be cool to raise the log level from &ldquo;warning&rdquo; to &ldquo;debug&rdquo; just for specific conditions? That&rsquo;s what I just added some time ago and it landed in ownCloud 8."><meta itemprop=datePublished content="2015-07-22T19:46:00+00:00"><meta itemprop=dateModified content="2015-07-22T19:46:00+00:00"><meta itemprop=wordCount content="356"><meta itemprop=keywords content></head><body><div class=header><div class=container><span class=name>Morris<b>Jobke</b></span><ul class=menu><li><a href=/>Articles</a></li>/<li><a href=/emobility>E-mobility</a></li>/<li><a href=/talks>Talks</a></li>/<li><a href=/links>Links</a></li><li class=item-right><a href=/feed.xml><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M576 1344q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm512 123q2 28-17 48-18 21-47 21H889q-25 0-43-16.5t-20-41.5q-22-229-184.5-391.5T250 902q-25-2-41.5-20T192 839V704q0-29 21-47 17-17 43-17h5q160 13 306 80.5T826 902q114 113 181.5 259t80.5 306zm512 2q2 27-18 47-18 20-46 20h-143q-26 0-44.5-17.5T1329 1476q-12-215-101-408.5t-231.5-336-336-231.5T252 398q-25-1-42.5-19.5T192 335V192q0-28 20-46 18-18 44-18h3q262 13 501.5 120T1186 542q187 186 294 425.5t120 501.5z" fill="#fff"/></svg></a></li><li class=item-right><a href=https://twitter.com/MorrisJobke><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z" fill="#fff"/></svg></a></li><li class=item-right><a href=https://github.com/MorrisJobke><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1664 896q0 251-146.5 451.5T1139 1625q-27 5-39.5-7t-12.5-30v-211q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 89t.5 54q0 18-13 30t-40 7q-232-77-378.5-277.5T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z" fill="#fff"/></svg></a></li></ul></div></div><div class=container><h1>Conditional Logging in ownCloud <span class=meta>22 Jul 2015</span></h1><div id=post><p>If you have an installation of ownCloud and you experience a bug it is quite difficult to debug the problem, because usually only errors and warnings are logged. But to identify a problem it is really helpful to log more stuff to get all the information that are needed. Wouldn&rsquo;t it be cool to raise the log level from &ldquo;warning&rdquo; to &ldquo;debug&rdquo; just for specific conditions? That&rsquo;s what <a href=https://github.com/owncloud/core/pull/15965>I just added some time ago</a> and it landed in ownCloud 8.1.</p><h2 id=conditions>Conditions</h2><p>There are three different types of conditions that can be used:</p><ul><li>use a <strong>shared secret</strong> that is added to a request</li><li>a list of <strong>users</strong></li><li>a list of <strong>apps</strong></li></ul><p>Once the log message meets one of the set up conditions it will be logged no matter what the log level is.</p><h2 id=example-settings>Example settings</h2><p>To setup conditional logging the following config parameter needs to be set in <code>config.php</code>:</p><pre><code>'log.condition' =&gt; [
	'shared_secret' =&gt; '57b58edb6637fe3059b3595cf9c41b9',
	'users' =&gt; ['sample-user'],
	'apps' =&gt; ['files'],
],
</code></pre><p>By default <code>log.condition</code> is set to an empty array. All array entries are optional. This means that it is also allowed to only specify the list of apps.</p><p>The options for users and apps are quite self-explanatory: If the request is made by a user that is in the list all log messages will be written or if the log message is raised by an app that is in the list then all log messages will be written.</p><p>The option <code>shared_secret</code> is something special to pick a very specific use case. If you notice that for a single request something bad happens then you can add a parameter named <code>log_secret</code> with the exact same value as set in the config to log all messages of this single request. Be aware to use a random string that isn&rsquo;t easy to guess and remove the setting once it is not needed anymore.</p><p>For example following request will cause to write all log messages during the execution (given that the above config is applied):</p><pre><code>curl -X PROPFIND -u another-user:password \
  https://own.cloud/remote.php/webdav/\?log_secret\=57b58edb6637fe3059b3595cf9c41b9
</code></pre><p>The parameter doesn&rsquo;t need to be a GET parameter - a POST parameter will also be detected.</p></div></div><div class="container footer">Morris Jobke - <a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a></div></body></html>